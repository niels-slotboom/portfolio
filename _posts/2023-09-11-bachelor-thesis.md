---
layout: post
title: "Bachelor Thesis: RF Pulse Development for Homogeneous Excitation in MRI"
author: "Niels Slotboom"
tags: Academic Thesis
excerpt_separator: <!--more-->
---

Full thesis title:
<h2>Development and Theoretical Study of RF Pulses for Globally Spatially Homogeneous Excitation in Magnetic Resonance Imaging at (X)UHF</h2>
<!--more-->

This post gives an overview of my bachelor thesis, which I wrote under the supervision of Thomas Feurer at the University of Bern. I cannot post the full PDF, since the thesis (and the research project emerging from it) led to ideas that may eventually be patented or developed further with industry partners.


<figure style="margin-left: 0em; margin-right: 0em;">
  <img src="{{ site.baseurl }}/assets/magnetisation.png" alt="Magnetisation induced by a CP-Mode and an optimised pTx Pulse" style="max-width:100%; height:auto; margin-left: 0em; margin-right: 0em;">
</figure>


Parallel transmission (pTx) MRI at high field strengths—such as 7T—faces a fundamental challenge: radiofrequency (RF) fields from the multiple transmit channels interfere with one another, leading—to in particular—destructive interference and dark spots in certain portions of the resulting images—such as in the top right plot of the figure above. This reduces their clinical usefulness, as relevant parts of the imaged tissue may be poorly visible or, worse, artefacts may skew diagnoses.

To address this, the first step was to develop a simulation framework capable of predicting the magnetisation response to arbitrary RF pulses in a parallel transmission setup. This required solving Maxwell's equations to obtain the complex electromagnetic fields generated by each transmit channel at the RF frequency, followed by computing their effect on the nuclear spin system via Bloch's equations. I formulated a quaternionic version of Bloch's equations tailored for this purpose, enabling a numerically stable and efficient method to apply induced rotations to the magnetisation vector. The simulation was then embedded into a gradient descent algorithm which iteratively adjusted pulse parameters to reduce excitation inhomogeneity—effectively turning the physics simulation into the inner loop of a tightly integrated optimisation pipeline, tightly integrated into a loss function to be optimised.

The entire framework was implemented in CUDA C and designed to have all its simulatory parts ran on the GPU. Each RF source's field contribution is simulated once and stored as a three-dimensional complex vector field of the frequency contribution at the RF frequency. Both the Maxwell and quaternion-based Bloch simulations were extensively optimised for throughput and memory efficiency—not just via coalesced memory access and careful use of constant/shared memory, but also through inspection of the CUDA assembly generated by `ptxas`, allowing identification of instruction overhead, register spilling, and other low-level inefficiencies. Since each optimisation run evaluates thousands of pulse configurations across moderately large 3D grids, performance was a central concern—not just for speed, but for eventual clinical viability: the long-term aim is to acquire the patient’s geometry, simulate the RF interactions, optimise a tailored pulse, and deploy it—all within the time a patient can reasonably lie still in a scanner. Once the electromagnetic field is known, the framework achieves evaluation times of just a few milliseconds per pulse configuration.

To illustrate the effect of the optimisation, the plots above compare the excitation patterns produced by a standard circular polarisation (CP) mode pulse and by an optimised pulse computed using my simulation framework. Each row shows three quantities across a central slice of the simulated head model: the phase angle of the magnetisation in the transverse _xy_-plane (left), the polar angle relative to the main magnetic field direction (middle), and the magnitude of the transverse magnetisation (right), which corresponds directly to the locally measurable MR signal strength. While CP mode exhibits substantial inhomogeneity—especially in the signal magnitude—the optimised pulse achieves a markedly more uniform excitation across the tissue.